name: Build NGINX-PARTY .deb 🚀

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    env:
      ENABLE_MODSEC: true
      MODSEC_MODE: DetectionOnly
      NGINX_VERSION: latest
      OPENSSL_VERSION: 3.3.1

    steps:
      - name: Checkout repo 📥
        uses: actions/checkout@v3

      - name: Setup Build Dependencies ⚙️
        run: |
          sudo apt-get update
          sudo apt-get install -y build-essential zlib1g-dev libpcre3-dev \
            libssl-dev cmake git curl wget pkg-config libmaxminddb-dev \
            libbrotli-dev libzstd-dev autoconf automake libtool

      - name: Build NGINX-PARTY .deb 🐧
        run: |
          ./build.sh  # your existing build script

      - name: Upload .deb artifact 📦
        uses: actions/upload-artifact@v4
        with:
          name: nginx-party-deb
          path: ./deb/*.deb
