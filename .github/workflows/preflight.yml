name: ğŸ’» Preflight Checks

on:
  workflow_dispatch:

jobs:
  preflight:
    name: âš¡ Preflight
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout Repo
        uses: actions/checkout@v4

      - name: ğŸ§ Install Preflight Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y git build-essential wget curl ccache unzip tar cmake

      - name: ğŸ” Verify Modules
        run: |
          # ModSecurity
          if [ "$ENABLE_MODSEC" = "true" ]; then
            if [ ! -d "./ModSecurity" ]; then
              echo "âŒ ModSecurity repo missing"
              exit 1
            fi
          fi

          # Brotli
          if [ ! -d "./ngx_brotli/deps/brotli" ]; then
            echo "âŒ Brotli submodule missing or not initialized"
            exit 1
          fi

          echo "âœ… Soft preflight completed"
        env:
          ENABLE_MODSEC: true