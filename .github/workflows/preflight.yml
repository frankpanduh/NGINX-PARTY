name: ğŸ› ï¸ Preflight Check

on:
  workflow_dispatch:

jobs:
  preflight:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout Repo
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: ğŸ§ Update & Install Dependencies
        run: |
          echo "ğŸ”„ Updating package list..."
          sudo apt-get update -qq
          echo "âœ… Installing build essentials & dev libraries..."
          sudo apt-get install -y \
            build-essential \
            autoconf \
            automake \
            libtool \
            pkg-config \
            cmake \
            gcc \
            g++ \
            make \
            libpcre3-dev \
            zlib1g-dev \
            libssl-dev \
            python3-dev \
            swig \
            libxml2-dev \
            libxslt1-dev \
            libbrotli-dev \
            libzstd-dev \
            git \
            curl \
            wget
          echo "ğŸ“¦ Dependencies installed!"

      - name: ğŸ—‚ï¸ Ensure Placeholder Directories
        run: |
          echo "ğŸ”¨ Creating example directories if missing..."
          mkdir -p ./example/
          mkdir -p ./ngx_brotli/deps/brotli
          mkdir -p ./ModSecurity/test/test-cases/secrules-language-tests
          echo "âœ… Placeholder directories ready!"

      - name: ğŸ”— Submodules Status
        run: |
          echo "ğŸ”„ Initializing and updating submodules..."
          git submodule init
          git submodule update --recursive
          echo "ğŸ“Œ Submodules are up to date!"

      - name: ğŸ“ Check Build Tools
        run: |
          echo "ğŸ” Verifying key build tools..."
          which gcc || echo "âš ï¸ gcc missing!"
          which make || echo "âš ï¸ make missing!"
          cmake --version || echo "âš ï¸ cmake missing!"
          pkg-config --version || echo "âš ï¸ pkg-config missing!"
          echo "âœ… All required tools checked!"
