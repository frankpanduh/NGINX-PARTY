name: 💻 Preflight Checks

on:
  workflow_dispatch:

jobs:
  preflight:
    runs-on: ubuntu-latest
    steps:
      - name: 📥 Checkout Repo
        uses: actions/checkout@v4

      - name: 💻 Install Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install --no-install-recommends -y \
            build-essential git wget curl libpcre3-dev zlib1g-dev libssl-dev \
            libxml2-dev libxslt1-dev libgd-dev libgeoip-dev libtool automake \
            libyajl-dev liblmdb-dev libluajit-5.1-dev \
            php8.3-cli php8.3-fpm mariadb-client composer redis-server \
            ccache unzip tar
          sudo rm -rf /var/lib/apt/lists/*

      - name: 🛡️ Verify Modules
        run: |
          echo "Checking for required modules..."
          [[ -d ./ngx_brotli ]] || echo "❌ ngx_brotli missing"
          [[ -d ./ngx_cache_purge ]] || echo "❌ ngx_cache_purge missing"
          [[ -d ./ngx-fancyindex ]] || echo "❌ ngx-fancyindex missing"
          [[ -d ./ModSecurity/nginx ]] || echo "❌ ModSecurity/nginx missing"
          echo "✅ Preflight done"